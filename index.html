<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>Eiffel Tower on Mapbox</title>
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
  <!-- Include the Mapbox GL CSS -->
  <link href='https://api.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.css' rel='stylesheet' />
  <style>
    body, html { height: 100%; margin: 0; padding: 0; }
    #map { height: 100%; }
  </style>
</head>
<body>
  <div id="map"></div>
  <!-- Include the Mapbox GL JS -->
  <script src='https://api.mapbox.com/mapbox-gl-js/v3.3.0/mapbox-gl.js'></script>
  <script>
    mapboxgl.accessToken = 'pk.eyJ1IjoiaGFydWNoYW5uIiwiYSI6ImNsdnFlZWRidTAyNmkya21yem1wMjhzZHUifQ.GrEXJlVvv0ljdkQXoEQTTQ';
    const map = new mapboxgl.Map({
      container: 'map', // container ID
      style:  'mapbox://styles/haruchann/clvqqksup01r901qpg3d0hynv',  // style URL
      center: [2.2945, 48.8584], // initial center coordinates
      zoom: 3.5, // initial zoom
      pitch: 0, // pitch in degrees
      bearing: 0 // bearing in degrees
    });


    map.addControl(new mapboxgl.NavigationControl());

    map.on('style.load', () => {
        map.setFog({}); // Set the default atmosphere style
    });

  const newsArticles = [
      {
        title: "OECD Meeting",
        date: "05/03/2024",
        content: "There was a meeting at the OECD.",
        location: [2.270402882611044,48.86407685222538,]
      },
{
  "title": "Saudi Steel Market Update",
  "date": "05/03/2024",
  "content": "Jubail-based mill offers rebar-grade billet at SAR 2,030/t. Scrap flows improving but prices remain firm. Induction furnace-route billet prices steady nationwide. Riyadh rebar prices below re-rollers’ procurement cost.",
  "location": [49.660455865746,27.015762770190104, ]
},
{
  "title": "US Steel Updates and Outlook",
  "date": "05/03/2024",
  "content": "US Steel commissions new coating line at Big River Steel. First-quarter earnings show decline in net earnings and net sales. Adjusted Ebitda slightly below guidance but reflects efficient operations amidst market changes. CEO anticipates stronger second quarter.",
  "location": [ -89.59850503968177,38.73332565415621,]
},
{
  "title": "ArcelorMittal Restocking Outlook",
  "date": "05/03/2024",
  "content": "ArcelorMittal observes a waiting period for a rebound in restocking. Sentiment stabilizes, awaiting consumption increase due to low inventory levels. Maintains global steel demand growth forecast for 2024. Q1 shows declines in production, shipments, net profit, and Ebitda, but revenue grows compared to Q4 2023. European steel spreads improve, US prices stabilize influenced by low inventory. Challenges noted from China’s excess steel production and rising exports. Focus on upcoming projects for low-emission steel supply.",
  "location": [6.143465193777926,49.62180385642374, ]
}

      // Add more articles here
    ];


    newsArticles.forEach(article => {
      const marker = new mapboxgl.Marker()
        .setLngLat(article.location)
        .addTo(map);

      const popupContent = `
        <strong>Title:</strong> ${article.title}<br>
        <strong>Date:</strong> ${article.date}<br>
        <p>${article.content}</p>
      `;
      
      const popup = new mapboxgl.Popup({ offset: 25 })
        .setHTML(popupContent);

      marker.setPopup(popup);
    });

    // Globe spinning logic
    const secondsPerRevolution = 240;
    let userInteracting = false;
    let spinEnabled = true;

    function spinGlobe() {
        if (spinEnabled && !userInteracting) {
            let distancePerSecond = 360 / secondsPerRevolution;
            const center = map.getCenter();
            center.lng -= distancePerSecond;
            map.easeTo({ center, duration: 1000, easing: (n) => n });
        }
    }

    map.on('click', () => {
        userInteracting = true;
        spinEnabled = false; // Stop spinning when map is clicked
    });

    map.on('moveend', () => {
        if (!userInteracting) {
            spinGlobe(); // Resume spinning only if user interaction flag is reset
        }
    });

    spinGlobe();
  </script>
</body>
</html>
