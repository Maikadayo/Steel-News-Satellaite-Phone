<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>Today’s Steel News</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    body, html {
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
      background: rgba(0, 0, 0, 0.5)
        url('https://api.mapbox.com/styles/v1/mapbox/satellite-v9/static/0,0,1/800x600?access_token=pk.eyJ1IjoiaGFydWNoYW5uIiwiYSI6ImNsdnFlZWRidTAyNmkya21yem1wMjhzZHUifQ.GrEXJlVvv0ljdkQXoEQTTQ')
        no-repeat center center fixed;
      background-blend-mode: darken;
      background-size: cover;
    }

    #header, #footer {
      width: 100%;
      padding: 10px;
      background: #333;
      color: #fff;
      text-align: center;
      font-size: 15px;
    }

    #footer {
      position: fixed;
      bottom: 0;
      left: 0;
    }

    #menu {
      width: 100%;
      padding: 10px 0;
      background: #555;
      color: #fff;
      text-align: center;
    }

    #menu a {
      margin: 0 10px;
      color: #fff;
      text-decoration: none;
    }

    #container {
      display: flex;
      flex-direction: column;
      height: calc(100% - 100px); /* header+menu+footer想定 */
      overflow: hidden;
      position: relative;
    }

    .page {
      padding: 10px;
      overflow-y: auto;
      flex: 1;
      display: none;
    }
    .page.active {
      display: block;
    }

    .section {
      margin-bottom: 20px;
    }

    .section-title {
      font-size: 18px;
      margin-bottom: 10px;
      color: #fff;
    }

    .news-item {
      padding: 10px;
      border: 1px solid #ddd;
      background-color: #fff;
      margin-bottom: 10px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    .news-item:hover {
      background-color: #eee;
    }

    .news-content-small {
      font-size: 12px;
      color: #666;
      display: block;
      margin-top: 5px;
    }

    .news-content {
      display: none;
      padding: 10px;
      box-sizing: border-box;
      background-color: #ffffff;
    }

    .button {
      display: inline-block;
      padding: 5px 10px;
      margin-top: 10px;
      background-color: #333;
      color: #fff;
      text-align: center;
      cursor: pointer;
      border: none;
      border-radius: 5px;
    }

    .comment-section {
      margin-top: 20px;
    }

    .comment-form {
      display: flex;
      flex-direction: column;
    }

    .comment-form input,
    .comment-form textarea {
      padding: 10px;
      margin-bottom: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      font-family: Arial, sans-serif;
    }

    .comment-form textarea {
      font-size: 14px;
    }

    .comment-form button {
      padding: 10px;
      background-color: #333;
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }

    .comments {
      margin-top: 10px;
      max-height: 100px;
      overflow-y: auto;
    }

    .comment {
      padding: 10px;
      border-bottom: 1px solid #ddd;
      font-size: 14px;
    }
  </style>
</head>

<body>
  <div id="header">Today’s Steel News</div>

  <div id="menu">
    <a href="#" data-nav="today">Today's News</a>
    <a href="#" data-nav="past">Past News</a>
  </div>

  <div id="container">
    <!-- Today's News -->
    <div id="page-today" class="page active" data-section="today">
      <div class="section" id="gmk">
        <div class="section-title">GMK center</div>
      </div>
      <div class="section" id="kallanish">
        <div class="section-title">Kallanish</div>
      </div>
      <div class="section" id="steel_orbis">
        <div class="section-title">Steel Orbis</div>
      </div>
      <div class="section" id="academic">
        <div class="section-title">Academic</div>
      </div>
    </div>

    <!-- Past News -->
    <div id="page-past" class="page" data-section="past">
      <div class="section-title">Past News</div>
      <!-- Past news will be dynamically populated here -->
    </div>
  </div>

  <div id="footer">© 2024 Steel News</div>

  <script>
    // ▼▼▼ ここから記事データ（category を新カテゴリに合わせています） ▼▼▼
    const newsArticles = [
      {
        title: "Nippon vice chairman resumes USS takeover promotion tour",
        date: "05/06/2024",
        content:
          "Nippon Steel's vice chairman Takahiro Mori is back in the US to advance the company's acquisition of US Steel...",
        category: "kallanish",
        copyofNews:
          "US domestic rebar prices have dropped to $790-800/short ton from $790-810/short ton last week..."
      },
      {
        title: "Low EU consumption discourages coil price increases",
        date: "05/06/2024",
        content:
          "European steelmakers are considering hot rolled coil (HRC) price increases, but weak demand across end-use sectors...",
        category: "kallanish",
        copyofNews:
          "US domestic rebar prices have dropped to $790-800/short ton from $790-810/short ton last week..."
      },
      {
        title: "EU quota cap could impact Indian HRC imports",
        date: "06/06/2024",
        content:
          "India may experience an increase in hot rolled coil (HRC) steel imports due to Europe’s residual tariff-rate quota...",
        category: "kallanish",
        copyofNews:
          "India may see a rise in hot rolled coil steel imports as an unintended consequence of Europe’s residual tariff-rate quota..."
      },
      {
        title: "US calculates dumping margin for Korean wire rod",
        date: "06/06/2024",
        content:
          "The US Department of Commerce preliminarily finds that South Korean producer and exporter Posco sold carbon and alloy steel wire rods below fair market value...",
        category: "kallanish",
        copyofNews:
          "According to a 5 June update to the Federal Register, Commerce assigned Posco a weighted average dumping margin of 1.03%..."
      },
      {
        title: "Russian steel consumption to grow 1-2% annually: Severstal",
        date: "06/06/2024",
        content:
          "Projected Growth in Steel Consumption: Russian steel consumption is expected to grow by 1-2% annually over the next five years...",
        category: "gmk",
        copyofNews:
          "Steel consumption in Russia will grow by approximately 1-2% annually over the next five years, but higher rates are also possible..."
      }
    ];

    #### The day definition
    // ===== Today / Past を日付で振り分け =====
const todayList = newsArticles.filter(a => a.date === "30/01/2030");
const pastList  = newsArticles.filter(a => a.date !== "30/01/2030");


    const sections = {
      gmk: document.getElementById("gmk"),
      kallanish: document.getElementById("kallanish"),
      steel_orbis: document.getElementById("steel_orbis"),
      academic: document.getElementById("academic")
    };

    let activeContentDiv = null;

    function loadComments() {
      const commentsData = JSON.parse(localStorage.getItem("commentsData")) || {};
      newsArticles.forEach((article) => {
        const commentsToday = document.querySelector(
          `.comments[data-title="${cssEscape(article.title)}"]`
        );
        const commentsPast = document.querySelector(
          `.comments[data-title-past="${cssEscape(article.title)}"]`
        );

        const articleComments = commentsData[article.title] || [];
        articleComments.forEach((comment) => {
          const commentDiv = document.createElement("div");
          commentDiv.className = "comment";
          commentDiv.innerHTML = `<strong>${escapeHtml(comment.name)}:</strong> ${escapeHtml(comment.text)}`;

          if (commentsToday) commentsToday.appendChild(commentDiv.cloneNode(true));
          if (commentsPast) commentsPast.appendChild(commentDiv.cloneNode(true));
        });
      });
    }

    function saveComment(title, name, text) {
      const commentsData = JSON.parse(localStorage.getItem("commentsData")) || {};
      if (!commentsData[title]) commentsData[title] = [];
      commentsData[title].push({ name, text });
      localStorage.setItem("commentsData", JSON.stringify(commentsData));
    }

    function createNewsItem(article, mode /* "today" | "past" */) {
      const newsItem = document.createElement("div");
      newsItem.className = "news-item";
      newsItem.innerHTML = `${escapeHtml(article.title)}
        <span class="news-content-small">${escapeHtml(article.content)}</span>`;

      const contentDiv = document.createElement("div");
      contentDiv.className = "news-content";
      contentDiv.innerHTML = `
        <button class="button copy-btn" data-copy="${escapeAttr(article.copyofNews)}">Copy Detail</button>

        <div class="comment-section">
          <form class="comment-form">
            <input type="text" placeholder="Your name..." required />
            <textarea rows="2" placeholder="Write your comment..." required></textarea>
            <button type="submit" class="button">Submit</button>
          </form>
          <div class="comments" ${
            mode === "today"
              ? `data-title="${escapeAttr(article.title)}"`
              : `data-title-past="${escapeAttr(article.title)}"`
          }></div>
        </div>
      `;

      newsItem.appendChild(contentDiv);

      newsItem.addEventListener("click", (event) => {
        // クリックで開閉（ボタンやフォーム操作は除外）
        if (
          event.target.closest("button") ||
          event.target.closest("form") ||
          event.target.closest("input") ||
          event.target.closest("textarea")
        ) return;

        if (activeContentDiv && activeContentDiv !== contentDiv) {
          activeContentDiv.style.display = "none";
        }
        const next = contentDiv.style.display === "block" ? "none" : "block";
        contentDiv.style.display = next;
        activeContentDiv = next === "block" ? contentDiv : null;
      });

      // Copy Detail
      contentDiv.querySelector(".copy-btn").addEventListener("click", (e) => {
        e.stopPropagation();
        const txt = e.currentTarget.getAttribute("data-copy") || "";
        navigator.clipboard?.writeText(txt);
        e.currentTarget.textContent = "Copied!";
        setTimeout(() => (e.currentTarget.textContent = "Copy Detail"), 900);
      });

      // Comment submit
      contentDiv.querySelector(".comment-form").addEventListener("submit", (event) => {
        event.preventDefault();
        const form = event.currentTarget;
        const name = form.querySelector("input").value.trim();
        const commentText = form.querySelector("textarea").value.trim();
        if (!name || !commentText) return;

        const commentsEl = form.parentElement.querySelector(".comments");
        const title =
          commentsEl.getAttribute("data-title") || commentsEl.getAttribute("data-title-past");

        const comment = document.createElement("div");
        comment.className = "comment";
        comment.innerHTML = `<strong>${escapeHtml(name)}:</strong> ${escapeHtml(commentText)}`;
        commentsEl.appendChild(comment);

        saveComment(title, name, commentText);

        form.querySelector("input").value = "";
        form.querySelector("textarea").value = "";
      });

      return newsItem;
    }

    // Today's News：カテゴリ別に追加
    // ===== Today's News：今日分だけ表示 =====
todayList.forEach((article) => {
  const item = createNewsItem(article, "today");
  if (sections[article.category]) {
    sections[article.category].appendChild(item);
  } else {
    sections.academic.appendChild(item);
  }
});

    // Past News：全件追加
    const pastPage = document.getElementById("page-past");
pastList.forEach((article) => {
  pastPage.appendChild(createNewsItem(article, "past"));
});

    // メニュー切り替え
    document.querySelectorAll("#menu a[data-nav]").forEach((a) => {
      a.addEventListener("click", (e) => {
        e.preventDefault();
        const target = a.getAttribute("data-nav");
        showSection(target);
      });
    });

    function showSection(section) {
      document.querySelectorAll(".page").forEach((p) => p.classList.remove("active"));
      document.getElementById(`page-${section}`).classList.add("active");
      // ページ切替時に開いている詳細は閉じる
      if (activeContentDiv) {
        activeContentDiv.style.display = "none";
        activeContentDiv = null;
      }
    }

    // HTMLエスケープ系（簡易）
    function escapeHtml(str) {
      return String(str)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#39;");
    }
    function escapeAttr(str) {
      return escapeHtml(str).replaceAll("\n", " ");
    }
    // querySelector用（CSSエスケープ）
    function cssEscape(str) {
      return String(str).replaceAll('"', '\\"');
    }

    // ページロード時にコメント復元
    document.addEventListener("DOMContentLoaded", loadComments);
  </script>
</body>
</html>
